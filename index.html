<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WMessage Web - José</title>

  <link rel="stylesheet" href="/css/style.css" />

  <!-- SheetJS (XLSX) for reading Excel/CSV -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>WMessage Web</h1>
      <p class="muted">Crea mensajes personalizados desde Excel/CSV y ábrelos en WhatsApp (tú envías para evitar bloqueos).</p>
    </header>

    <main class="card">
      <section class="row">
        <label class="filepicker">
          <input id="file-input" type="file" accept=".xlsx,.xls,.csv" />
          <span>Seleccionar archivo (.xlsx .csv)</span>
        </label>

        <div class="fileinfo" id="file-info">Ningún archivo cargado</div>
      </section>

      <section class="row" id="columns-area" hidden>
        <div>
          <h3>Columnas detectadas</h3>
          <div id="columns-list" class="pill-list"></div>
        </div>

        <div class="col-select">
          <label>Columna teléfono:
            <select id="phone-col"></select>
          </label>

          <label>Modo WhatsApp:
            <select id="mode-select">
              <option value="web">Web (web.whatsapp.com)</option>
              <option value="desktop">Desktop (whatsapp://)</option>
            </select>
          </label>
        </div>
      </section>

      <section id="template-area" hidden>
        <h3>Plantilla de mensaje</h3>
        <textarea id="template" rows="5" placeholder="Escribe tu plantilla aquí..."></textarea>
        <div class="controls">
          <button id="preview-btn">Previsualizar 5</button>
          <button id="start-btn">Iniciar UNO-por-UNO</button>
          <button id="open-all-btn">Abrir todas (pestañas)</button>
          <button id="export-btn">Exportar resultados (CSV)</button>
        </div>
      </section>

      <section id="progress-area" hidden>
        <div class="progress-row">
          <div id="progress-text">Total: 0 | Enviado: 0 | No enviado: 0 | Pendiente: 0</div>
          <div id="progress-bar"><div id="progress-fill"></div></div>
        </div>
      </section>

      <section id="preview-area" hidden>
        <h3>Previsualización</h3>
        <div id="preview-list" class="preview-list"></div>
      </section>

      <p class="note">IMPORTANTE: El sistema <strong>no envía</strong> mensajes automáticamente. Tú revisas y presionas Enviar en WhatsApp.</p>
    </main>
  </div>

  <!-- Modal UNO POR UNO -->
  <div id="modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <button class="close-modal" id="close-modal" title="Cerrar">✕</button>
      <h2 id="modal-title">Contacto</h2>
      <div id="modal-meta" class="meta"></div>
      <textarea id="modal-message" rows="8"></textarea>
      <div class="modal-phone" id="modal-phone"></div>
      <div class="modal-actions">
        <button id="modal-open">Abrir WhatsApp</button>
        <button id="modal-sent">Enviado ✅</button>
        <button id="modal-not-sent">No enviado ❌</button>
        <button id="modal-next">Siguiente →</button>
        <button id="modal-copy">Copiar mensaje</button>
      </div>
    </div>
  </div>

  <script src="/js/app.js"></script>
</body>
</html>
