<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WMessage - Supabase (UMES)</title>

  <link rel="stylesheet" href="./css/style.css" />

  <!-- SheetJS para leer Excel/CSV -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Supabase JS (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="logo-row">
        <div class="logo">
          <img src="./UMES.png" alt="Logo UMES" id="site-logo" />
        </div>
        <div class="title">
          <h1>WMessage <span>UMES</span></h1>
          <p class="muted">Envíos WhatsApp — Multiusuario con Supabase</p>
        </div>
      </div>

      <div class="top-actions">
        <button id="saveProgress" class="btn info">Guardar progreso</button>
        <button id="exportExcel" class="btn success">Terminado y exportar</button>
        <button id="resetAll" class="btn danger">Reiniciar</button>
        <button id="finishBtn" class="btn info">Terminé (Resumen)</button>
      </div>
    </header>

    <main class="card">
      <!-- Sección de carga de archivo -->
      <section class="row">
        <label class="filepicker">
          <input id="file-input" type="file" accept=".xlsx,.xls,.csv" />
          <span>Seleccionar archivo (.xlsx, .xls, .csv)</span>
        </label>
        <div class="fileinfo" id="file-info">Ningún archivo cargado</div>
      </section>

      <!-- Columnas detectadas -->
      <section class="row" id="columns-area" hidden>
        <div class="columns-block">
          <h3>Columnas detectadas</h3>
          <div id="columns-list" class="pill-list"></div>
        </div>

        <div class="col-select">
          <label>Columna teléfono:
            <select id="phone-col"></select>
          </label>

          <label>Modo WhatsApp:
            <select id="mode-select">
              <option value="web">Web (web.whatsapp.com)</option>
              <option value="desktop">Desktop (whatsapp://)</option>
            </select>
          </label>
        </div>
      </section>

      <!-- Plantilla -->
      <section id="template-area" hidden>
        <h3>Plantilla de mensaje</h3>
        <textarea id="template" rows="5" placeholder="Hola {{Nombre}}, tu carrera es {{Carrera}}..."></textarea>

        <div class="controls">
          <button id="preview-btn" class="btn">Previsualizar resultados</button>
          <button id="start-btn" class="btn outline">Modo UNO-por-UNO</button>
          <button id="open-all-btn" class="btn ghost">Abrir todos (Lotes)</button>
        </div>

        <div class="search-row">
          <input id="search-input" type="text" placeholder="Buscar por nombre o teléfono..." />
          <label>Por página:
            <select id="per-page">
              <option>10</option>
              <option selected>20</option>
              <option>50</option>
              <option>100</option>
            </select>
          </label>
        </div>
      </section>

      <!-- Progreso -->
      <section id="progress-area" hidden>
        <div class="progress-row">
          <div id="progress-text">Total: 0 | Enviado: 0 | No enviado: 0 | Pendiente: 0</div>
          <div id="progress-bar"><div id="progress-fill"></div></div>
        </div>
      </section>

      <!-- Previsualizador -->
      <section id="preview-area" hidden>
        <h3>Previsualización</h3>
        <p class="note2">
          Cada contacto muestra su estado. Usa los botones para marcarlo.
        </p>
        <div id="preview-list" class="preview-list"></div>

        <!-- Paginación -->
        <div class="pager" id="pager" hidden>
          <button id="prev-page" class="btn ghost">◀ Anterior</button>
          <span id="pager-info"></span>
          <button id="next-page" class="btn ghost">Siguiente ▶</button>
        </div>
      </section>

      <p class="note">
        IMPORTANTE: El sistema <strong>no envía mensajes automáticamente</strong>.
        Tú debes presionar <strong>Enviar</strong> en WhatsApp.
      </p>
    </main>
  </div>

  <!-- Modal UNO-por-UNO -->
  <div id="modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <button class="close-modal" id="close-modal" title="Cerrar">✕</button>
      <h2 id="modal-title">Contacto</h2>
      <div id="modal-meta" class="meta"></div>
      <textarea id="modal-message" rows="8"></textarea>
      <div class="modal-phone" id="modal-phone"></div>
      <div class="modal-actions">
        <button id="modal-open" class="btn btn-send">Abrir WhatsApp</button>
        <button id="modal-sent" class="btn success">Enviado ✓</button>
        <button id="modal-not-sent" class="btn danger">No enviado</button>
        <button id="modal-next" class="btn outline">Siguiente →</button>
        <button id="modal-copy" class="btn ghost">Copiar mensaje</button>
      </div>
    </div>
  </div>

  <!-- Tu app.js -->
  <script src="./js/app.js"></script>
</body>
</html>